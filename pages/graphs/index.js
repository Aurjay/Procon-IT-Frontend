import React, { useEffect, useState } from 'react';
import { Card, CardContent, Typography } from '@material-ui/core';
import { LineChart, Line, XAxis, YAxis, Tooltip, CartesianGrid } from 'recharts';

const GraphPage = () => {
  const [data, setData] = useState([]);
  const [plotImage, setPlotImage] = useState('');

  useEffect(() => {
    const fetchData = async () => {
      const newData = [
        { x: 6471, y: 305.0301567850639 },
        { x: 6478, y: 302.53607956209834 },
        { x: 6492, y: 305.216294204459 },
        { x: 6496, y: 303.5317962884949 },
        { x: 6540, y: 307.6625841820582 },
        { x: 6545, y: 305.77220694042023 },
        { x: 6548, y: 307.68369266457347 },
        { x: 6556, y: 304.4596881469232 },
        { x: 6505, y: 307.71416900647404 },
        { x: 6528, y: 303.9604864515565 },
        { x: 6614, y: 305.4061049148997 },
        { x: 6621, y: 303.63202487582475 },
        { x: 6566, y: 308.8471214287545 },
        { x: 6590, y: 301.1826756651734 },
        { x: 6649, y: 313.0432190917943 },
        { x: 6653, y: 309.6870337856272 },
        { x: 6665, y: 314.7301770324879 },
        { x: 6670, y: 311.7900134281816 },
        { x: 6702, y: 310.5587764914065 },
        { x: 6712, y: 307.98064402098737 },
        { x: 6720, y: 311.6090882797546 },
        { x: 6725, y: 308.80448217412885 },
        { x: 6697, y: 306.58009187565824 },
        { x: 6736, y: 312.1228151270888 },
        { x: 6769, y: 309.0870911055297 },
        { x: 6775, y: 307.2866484469121 },
        { x: 6798, y: 314.2572040656657 },
        { x: 6802, y: 312.45118714170275 },
        { x: 6813, y: 310.2688808616384 },
        { x: 6816, y: 312.17690303740324 },
        { x: 6865, y: 310.04737089491886 },
        { x: 6872, y: 311.5937400504745 },
        { x: 6855, y: 311.636165309046 },
        { x: 6879, y: 309.24592919123126 },
        { x: 6805, y: 314.32606808693765 },
        { x: 6834, y: 306.8824595758128 },
        { x: 6923, y: 313.62601520512925 },
        { x: 6934, y: 311.32458059657625 },
        { x: 6889, y: 314.7835035348085 },
        { x: 6908, y: 307.5514476056818 },
        { x: 6672, y: 314.93496124471955 },
        { x: 6759, y: 304.9750328628702 },
        { x: 6939, y: 314.97510340143253 },
        { x: 6948, y: 312.2260634939755 },
        { x: 6971, y: 312.8015925818811 },
        { x: 6974, y: 314.4428192012336 },
        { x: 6963, y: 312.4724406104601 },
        { x: 6965, y: 315.13962192454056 },
        { x: 6980, y: 311.98614933459555 },
        { x: 6981, y: 313.81554947392493 },
        { x: 7006, y: 315.0743253437324 },
        { x: 7009, y: 313.2204853109259 },
        { x: 6995, y: 310.3777260487627 },
        { x: 7012, y: 315.2993213057296 },
        { x: 7051, y: 312.92433498546643 },
        { x: 7054, y: 311.3025158603068 },
        { x: 7076, y: 312.1719781622801 },
        { x: 7084, y: 314.18547393131865 },
        { x: 7064, y: 315.3751584159908 },
        { x: 7089, y: 311.84817357709056 },
        { x: 7122, y: 314.8612793310636 },
        { x: 7126, y: 312.9584602538781 },
        { x: 7137, y: 315.50014497236856 },
        { x: 7142, y: 313.33475136628704 },
        { x: 7145, y: 315.51847652493416 },
        { x: 7151, y: 312.4899092099934 },
        { x: 7092, y: 315.6100731409793 },
        { x: 7117, y: 311.4037917360139 },
        { x: 6955, y: 316.5832007010846 },
        { x: 7048, y: 309.9905325121355 },
        { x: 7207, y: 316.3157882734973 },
        { x: 7209, y: 318.3661126043934 },
        { x: 7198, y: 316.2799264142548 },
        { x: 7202, y: 318.4350770688864 },
        { x: 7223, y: 315.0198868910075 },
        { x: 7226, y: 316.75705533067224 },
        { x: 7240, y: 314.9690770259064 },
        { x: 7241, y: 316.64805574093134 },
        { x: 7234, y: 314.6430106194661 },
        { x: 7237, y: 316.7646313374902 },
        { x: 7252, y: 314.589008430952 },
        { x: 7256, y: 319.2318494518829 },
        { x: 7288, y: 314.15598955431705 },
        { x: 7290, y: 316.17324520781085 },
        { x: 7351, y: 317.7432626058289 },
        { x: 7354, y: 316.0330078264915 },
        { x: 7369, y: 315.3146583034409 },
        { x: 7371, y: 316.87772351820433 },
        { x: 7398, y: 315.607182030879 },
        { x: 7399, y: 317.42877886925595 },
        { x: 7377, y: 315.22510562693697 },
        { x: 7390, y: 317.74707052302927 },
        { x: 7346, y: 314.9324992939676 },
        { x: 7357, y: 317.80388439005515 },
        { x: 7417, y: 313.6891789099235 },
        { x: 7422, y: 317.0064945193145 },
        { x: 7309, y: 312.4550206829471 },
        { x: 7337, y: 319.43087539065215 },
        { x: 7482, y: 317.1775282529899 },
        { x: 7485, y: 315.3445436850669 },
        { x: 7475, y: 317.50282422408463 },
        { x: 7478, y: 315.2938833676343 },
        { x: 7513, y: 314.6809292539143 },
        { x: 7516, y: 317.740846687852 },
        { x: 7540, y: 316.9513922735987 },
        { x: 7547, y: 315.1067814038 },
        { x: 7497, y: 319.5139112506561 },
        { x: 7526, y: 314.3143174358485 },
        { x: 7182, y: 320.1618252566836 },
        { x: 7453, y: 310.6123244876139 },
        { x: 7602, y: 321.0690217171358 },
        { x: 7604, y: 322.9482043733485 },
        { x: 7620, y: 315.3038407989658 },
        { x: 7623, y: 318.8971211272474 },
        { x: 7665, y: 321.5574129864394 },
        { x: 7670, y: 319.0228763079424 },
        { x: 7680, y: 318.9510067651853 },
        { x: 7681, y: 320.6687664093664 },
        { x: 7701, y: 321.20821755958 },
        { x: 7718, y: 317.6870841174272 },
        { x: 7672, y: 321.59530368380086 },
      ];
      setData(newData);

      try {
        const response = await fetch('/api/plot');
        const blob = await response.blob();
        const objectURL = URL.createObjectURL(blob);
        setPlotImage(objectURL);
      } catch (error) {
        console.error('Error fetching plot image:', error);
      }
    };

    fetchData();
  }, []);

  return (
    <Card>
      <CardContent>
        <Typography variant="h6" component="h2">
          Graph
        </Typography>
        <LineChart width={1100} height={500} data={data}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="x" />
          <YAxis domain={[300, 325]}/>
          <Tooltip />
          <Line type="monotone" dataKey="y" stroke="#8884d8" />
        </LineChart>
        {plotImage && (
          <div>
            <Typography variant="h6" component="h2">
              Plot
            </Typography>
            <img src={plotImage} alt="Plot" />
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default GraphPage;
